<!DOCTYPE html>

<html>
  <head>
    <title>Home</title>

    <!-- Jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>

    <!-- Bootstrap stylesheet/javascript for page design -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <!-- JSX Transformer for using .jsx files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/0.13.3/JSXTransformer.js"></script>

    <!-- React -->
    <script src="https://unpkg.com/react@15/dist/react.js"></script>
    <script src="https://unpkg.com/react-dom@15/dist/react-dom.js"></script>

    <!-- Immutable -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/immutable/3.8.1/immutable.js"></script>

    <!-- Draft.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/draft-js/0.9.1/Draft.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/draft-js/0.9.1/Draft.css">

    <!-- React Bootstrap -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-bootstrap/0.30.7/react-bootstrap.js"></script>

    <style>
      body {
        overflow: hidden;
      }

      ::-webkit-scrollbar { 
        display: none; 
      }

      #header {
        height: 75px;
        min-height: 75px;
        margin-top: 40px;
        margin-bottom: 15px;
        background-color: #f9f9f9;
      }

      #content {
        height: 500px;
        min-height: 500px;
        background-color: #f9f9f9;
        overflow: scroll;
        margin-top: 0;
      }

      #file-upload {
        position: fixed;
        top: 10px;
        left: 37%;
      }

      #download-link {
        visibility: hidden;
      }

      .row {
        margin: 0 0 0 0;
        padding: 5px 15px 5px 0;
      }

      .glyphicon-folder-close {
        font-size: 24px;
        padding: 0 10px 0 5px;
        color: #0000e6;
      }

      a {
        vertical-align: super;
        color: #000000;
      }

      .hovered {
        background-color: #b3d9ff
      }

      .active {
        background-color: #66b3ff
      }

      .active.hovered {
        background-color: #4da6ff
      }

      .DraftEditor-editorContainer {
        height: 450px;
        margin: 0 -15px 6px -15px;
        padding: 0 15px 0 15px;
      }

      .public-DraftEditorPlaceholder-root {
        padding-left: 5px;
      }
    </style>

    <script src="./js/AppMain.react.jsx" type="text/jsx"></script>
    <script src="./js/AppHeader.react.jsx" type="text/jsx"></script>
    <script src="./js/FileSystem.react.jsx" type="text/jsx"></script>
    <script src="./js/TextEditor.react.jsx" type="text/jsx"></script>
    <script src="./js/TextEditorToolbar.react.jsx" type="text/jsx"></script>

    <script>
    var items = [
      {
        name: "Test1"
      },
      {
        name: "Test2"
      },
      {
        name: "Test2"
      },
      {
        name: "Test2"
      },
      {
        name: "Test2"
      },
      {
        name: "Test2"
      },
      {
        name: "Test2"
      },
      {
        name: "Test2"
      },
      {
        name: "Test2"
      },
      {
        name: "Test2"
      },
      {
        name: "Test2"
      },
      {
        name: "Test2"
      },
      {
        name: "Test2"
      },
      {
        name: "Test2"
      },
      {
        name: "Test2"
      },
      {
        name: "Test2"
      }
    ];

    var selected = {};

    var lastSelected = {};

    var inEditMode = false;

    var textContent = "";

    window.onload = function() {
      var username = sessionStorage.username;

      // PHP call to retreive user's home folder
    }

    document.onclick = function(e) {
      if(e.target.nodeName == "HTML" || e.target.nodeName == "BODY") clearSelection();
    }

    function clearSelection() {
      lastSelected = selected;
      selected = {};
      update();
    }

    function enterEditMode() {
      inEditMode = true;
      // PHP call to fetch document content
      textContent = ""; // Whatever is fetched or nothing

      update();
    }

    function exitEditMode() {
      lastSelected = {};
      selected = {};
      inEditMode = false;
      textContent = "";
      update();
    }

    function saveDocument() {
      // PHP call to update the document

      exitEditMode();
    }

    function addFolder() {
      // PHP call to create folder

      var name = document.getElementById("foldername").value;
      items.splice(0, 0, {name: name});

      $('#newfolder-modal').hide();
      update();
    }

    function exitModals() {
      $('#newfolder-modal').hide();
      $('#no-folder-modal').hide();
      $('#invalid-share-modal').hide();
      $('#success-share-modal').hide();
    }

    function shareFolder() {
      if(!selected.name /*|| !(selected.type == "folder")*/) $('#no-folder-modal').show();
      else {
        var name = document.getElementById("share-text").value;

        if(name == "") $('#invalid-share-modal').show();
        else {
          // PHP call to check if user exists
          // PHP call to share folder with user

          $('#success-share-modal').show();
        }
      }
    }

    function uploadTextFile() {
      var filething = document.getElementById("file-upload");

      var file = filething.files[0];

      if(file.type = "text/plain") {
        var reader = new FileReader();

        reader.readAsText(file);

        reader.onload = function() {
          alert(reader.result);
        }
      }
      else {

      }
    }

    function downloadTextFile() {
      var link = document.getElementById("download-link");

      link.download = "test.txt";
      link.href = "data:text/plain," + encodeURIComponent(textContent);
      link.click();
    }

    </script>
  </head>
  <body>
    <script type="text/jsx">
      setup_appheader();
      setup_app();

      function update() {
        setup_app();
      }
    </script>

    <div class="container" id="header">
      
    </div>
    <div class="container" id="content">

    </div>

    <a id="download-link" download="file.txt"></a>

    <div id="newfolder-modal" class="modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header" style="background-color: #f2f2f2">
            <h4 class="modal-title">Create a new folder</h4>
          </div>
          <div class="modal-body">
            <div class="form-group">
          <label for="foldername">Folder Name:</label>
          <input type="text" class="form-control" id="foldername">
        </div>
          </div>
          <div class="modal-footer" style="background-color: #f2f2f2">
            <button type="button" class="btn btn-default" onclick="exitModals()" style="float: left">Cancel</button>
            <button type="button" class="btn btn-default" onclick="addFolder()">Create</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div id="no-folder-modal" class="modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header" style="background-color: #f2f2f2">
            <h4 class="modal-title">No folder selected</h4>
          </div>
          <div class="modal-body">
          Please select a folder before performing this action.
          </div>
          <div class="modal-footer" style="background-color: #f2f2f2">
            <button type="button" class="btn btn-default" onclick="exitModals()">Ok</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div id="invalid-share-modal" class="modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header" style="background-color: #f2f2f2">
            <h4 class="modal-title">Invalid Share</h4>
          </div>
          <div class="modal-body">
          Please enter a valid user to share this folder with.
          </div>
          <div class="modal-footer" style="background-color: #f2f2f2">
            <button type="button" class="btn btn-default" onclick="exitModals()">Ok</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div id="success-share-modal" class="modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header" style="background-color: #f2f2f2">
            <h4 class="modal-title">Success!</h4>
          </div>
          <div class="modal-body">
          The folder has been shared with this user.
          </div>
          <div class="modal-footer" style="background-color: #f2f2f2">
            <button type="button" class="btn btn-success" onclick="exitModals()">Ok</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

  </body>
</html>